# ğŸ’¬ ChatBot - æ™ºèƒ½å¯¹è¯æœºå™¨äºº

åŸºäº LangGraph æ„å»ºçš„æ™ºèƒ½å¯¹è¯ç³»ç»Ÿï¼Œæ”¯æŒå·¥å…·è°ƒç”¨ã€è®°å¿†ç®¡ç†å’Œå¯¹è¯æ‘˜è¦ã€‚

## ğŸŒŸ ç‰¹æ€§

- **ğŸ” å®æ—¶æœç´¢**ï¼šé›†æˆ Tavily æœç´¢å¼•æ“ï¼Œè·å–æœ€æ–°ä¿¡æ¯
- **ğŸ’¾ å¯¹è¯è®°å¿†**ï¼šæŒä¹…åŒ–ä¿å­˜å¯¹è¯å†å²ï¼Œæ”¯æŒå¤šçº¿ç¨‹ç®¡ç†
- **ğŸ“ æ™ºèƒ½æ‘˜è¦**ï¼šè‡ªåŠ¨ç”Ÿæˆå’Œç®¡ç†å¯¹è¯æ‘˜è¦
- **ğŸ”§ å·¥å…·æ‰©å±•**ï¼šçµæ´»çš„å·¥å…·ç³»ç»Ÿï¼Œæ˜“äºæ·»åŠ æ–°åŠŸèƒ½
- **ğŸŒŠ æµå¼è¾“å‡º**ï¼šå®æ—¶æ˜¾ç¤ºå›ç­”ç”Ÿæˆè¿‡ç¨‹
- **ğŸ¯ æ™ºèƒ½è·¯ç”±**ï¼šè‡ªåŠ¨åˆ¤æ–­æ˜¯å¦éœ€è¦è°ƒç”¨å·¥å…·

## ğŸ“¦ ç»„ä»¶ç»“æ„

```
chatbot/
â”œâ”€â”€ __init__.py              # åŒ…åˆå§‹åŒ–
â”œâ”€â”€ chatbot.py               # ğŸ¯ æ ¸å¿ƒå¯¹è¯é€»è¾‘
â”œâ”€â”€ TavilySearchToolNode.py  # ğŸ”§ å·¥å…·æ‰§è¡ŒèŠ‚ç‚¹
â”œâ”€â”€ config.py                # âš™ï¸ é…ç½®ç®¡ç†
â”œâ”€â”€ logger.py                # ğŸ“ æ—¥å¿—ç³»ç»Ÿ
â”œâ”€â”€ utils.py                 # ğŸ› ï¸ é€šç”¨å·¥å…·å‡½æ•°
â””â”€â”€ summary.py               # ğŸ“„ å¯¹è¯æ‘˜è¦åŠŸèƒ½
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### åŸºç¡€å¯¹è¯

```python
from chatbot import ChatBot

# åˆå§‹åŒ–æœºå™¨äºº
bot = ChatBot()

# å‘é€æ¶ˆæ¯
result = bot.chat("ä½ å¥½ï¼Œä»Šå¤©åŒ—äº¬å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ")
print(result['response'])
```

### æµå¼å¯¹è¯

```python
# æµå¼è·å–å“åº”
for chunk in bot.stream_chat("è®²ä¸ªç¬‘è¯"):
    print(chunk, end='', flush=True)
```

### ç®¡ç†å¯¹è¯çº¿ç¨‹

```python
# ä½¿ç”¨ç‰¹å®šçº¿ç¨‹IDä¿æŒå¯¹è¯è¿ç»­æ€§
result = bot.chat("ç»§ç»­åˆšæ‰çš„è¯é¢˜", thread_id="user_123")

# è·å–å¯¹è¯å†å²
history = bot.get_conversation_history(thread_id="user_123")

# æ¸…é™¤æŸä¸ªçº¿ç¨‹çš„å†å²
bot.clear_thread(thread_id="user_123")
```

## âš™ï¸ é…ç½®é€‰é¡¹

é€šè¿‡ç¯å¢ƒå˜é‡æˆ– `ChatConfig` ç±»è¿›è¡Œé…ç½®ï¼š

| é…ç½®é¡¹ | ç¯å¢ƒå˜é‡ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|----------|--------|------|
| æ¨¡å‹åç§° | `MODEL_NAME` | `deepseek-chat` | ä½¿ç”¨çš„è¯­è¨€æ¨¡å‹ |
| API åœ°å€ | `BASE_URL` | `https://api.deepseek.com` | æ¨¡å‹ API åœ°å€ |
| æœ€å¤§ä»¤ç‰Œ | `MAX_TOKENS` | `4000` | å“åº”æœ€å¤§é•¿åº¦ |
| æ¸©åº¦ç³»æ•° | `TEMPERATURE` | `0.7` | ç”Ÿæˆéšæœºæ€§ï¼ˆ0-1ï¼‰ |
| æœç´¢ç»“æœæ•° | `MAX_SEARCH_RESULTS` | `5` | æ¯æ¬¡æœç´¢è¿”å›ç»“æœæ•° |
| é»˜è®¤çº¿ç¨‹ID | `DEFAULT_THREAD_ID` | `default` | é»˜è®¤å¯¹è¯çº¿ç¨‹ID |

## ğŸ“‹ API å‚è€ƒ

### ChatBot ç±»

#### ä¸»è¦æ–¹æ³•

- `chat(message, thread_id=None)` - å‘é€æ¶ˆæ¯å¹¶è·å–å›å¤
- `stream_chat(message, thread_id=None)` - æµå¼å¯¹è¯
- `get_conversation_history(thread_id=None)` - è·å–å¯¹è¯å†å²
- `clear_thread(thread_id=None)` - æ¸…é™¤å¯¹è¯å†å²
- `generate_summary(thread_id=None)` - ç”Ÿæˆå¯¹è¯æ‘˜è¦
- `get_summary(thread_id=None)` - è·å–å¯¹è¯æ‘˜è¦

#### å·¥å…·ç›¸å…³

- `save_graph_diagram(filepath="graph_diagram.png")` - ä¿å­˜å·¥ä½œæµå›¾

## ğŸ”§ æ‰©å±•å¼€å‘

### æ·»åŠ æ–°å·¥å…·

1. åœ¨ `chatbot.py` çš„ `_setup_tools` æ–¹æ³•ä¸­æ·»åŠ ï¼š

```python
from your_tool import YourTool

def _setup_tools(self):
    # ... ç°æœ‰å·¥å…· ...

    # æ·»åŠ æ–°å·¥å…·
    your_tool = YourTool()
    self.tools.append(your_tool)
    logger.info("æ·»åŠ äº†æ–°å·¥å…·ï¼šYourTool")
```

2. å·¥å…·ä¼šè‡ªåŠ¨ç»‘å®šåˆ°æ¨¡å‹å¹¶å¯ç”¨ã€‚

### è‡ªå®šä¹‰æ¶ˆæ¯å¤„ç†

ç»§æ‰¿ `ChatBot` ç±»å¹¶é‡å†™ç›¸åº”æ–¹æ³•ï¼š

```python
class CustomChatBot(ChatBot):
    def _chatbot_node(self, state):
        # è‡ªå®šä¹‰æ¶ˆæ¯å¤„ç†é€»è¾‘
        return super()._chatbot_node(state)
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **å·¥å…·è°ƒç”¨å¤±è´¥**
   - æ£€æŸ¥ `TAVILY_API_KEY` æ˜¯å¦è®¾ç½®
   - ç¡®è®¤ç½‘ç»œè¿æ¥æ­£å¸¸

2. **æ¨¡å‹å“åº”é”™è¯¯**
   - éªŒè¯ `DEEPSEEK_API_KEY` æœ‰æ•ˆæ€§
   - æ£€æŸ¥ API è®¿é—®é™åˆ¶

3. **å†…å­˜ä½¿ç”¨è¿‡é«˜**
   - è°ƒæ•´ `MAX_HISTORY_TOKENS` é…ç½®
   - å®šæœŸæ¸…ç†ä¸éœ€è¦çš„å¯¹è¯çº¿ç¨‹

## ğŸ“Š æ—¥å¿—è¯´æ˜

æ—¥å¿—çº§åˆ«å¯é€šè¿‡ `LOG_LEVEL` ç¯å¢ƒå˜é‡è®¾ç½®ï¼š

- `DEBUG` - è¯¦ç»†è°ƒè¯•ä¿¡æ¯
- `INFO` - å¸¸è§„è¿è¡Œä¿¡æ¯ï¼ˆé»˜è®¤ï¼‰
- `WARNING` - è­¦å‘Šä¿¡æ¯
- `ERROR` - é”™è¯¯ä¿¡æ¯

ç¤ºä¾‹æ—¥å¿—ï¼š

```
2025-12-05 14:15:23 - chatbot - INFO - å·¥å…·æ‰§è¡ŒèŠ‚ç‚¹åˆå§‹åŒ–å®Œæˆï¼Œå…±åŠ è½½ 1 ä¸ªå·¥å…·
2025-12-05 14:15:27 - chatbot - INFO - å¼€å§‹æ‰§è¡Œ 1 ä¸ªå·¥å…·è°ƒç”¨
2025-12-05 14:15:29 - chatbot - INFO - å·¥å…·æ‰§è¡Œå®Œæˆï¼šæˆåŠŸ 1 ä¸ªï¼Œå¤±è´¥ 0 ä¸ª
```

## ğŸ”— ç›¸å…³é“¾æ¥

- [è¿”å›é¡¹ç›®ä¸»é¡µ](../README.md)
- [LangGraph æ–‡æ¡£](https://python.langchain.com/docs/langgraph)
- [DeepSeek API æ–‡æ¡£](https://platform.deepseek.com/)
- [Tavily API æ–‡æ¡£](https://tavily.com/docs)